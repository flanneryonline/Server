#!/usr/bin/env bash

#this file is to update links that may be new or deleted since the last update
#since the running script might be from the previous commit a serparate file is required.

. /opt/server/environment
. /opt/server/include

#docker-compose
[ ! -d /etc/docker/compose ] && mkdir -p /etc/docker/compose
[ ! -e /etc/docker/compose/media-services ] && \
    ln -s /opt/server/docker-compose/media-services /etc/docker/compose/media-services
[ ! -h /etc/docker/compose/media-services ] && \
    rm -r /etc/docker/compose/media-services && \
    ln -s /opt/server/docker-compose/media-services /etc/docker/compose/media-services

#motd
chmod +x /opt/server/motd/*
[ ! -e /etc/update-motd.d/00-header ] && \
    ln -s /opt/server/motd/00-header /etc/update-motd.d/00-header
[ ! -h /etc/update-motd.d/00-header ] && \
    rm -r /etc/update-motd.d/00-header && \
    ln -s /opt/server/motd /etc/update-motd.d/00-header

[ ! -e /etc/update-motd.d/10-info ] && \
    ln -s /opt/server/motd/10-info /etc/update-motd.d/10-info
[ ! -h /etc/update-motd.d/10-info ] && \
    rm -r /etc/update-motd.d/10-info && \
    ln -s /opt/server/motd /etc/update-motd.d/10-info

[ ! -e /etc/update-motd.d/20-services ] && \
    ln -s /opt/server/motd/20-services /etc/update-motd.d/20-services
[ ! -h /etc/update-motd.d/20-services ] && \
    rm -r /etc/update-motd.d/20-services && \
    ln -s /opt/server/motd /etc/update-motd.d/20-services

[ ! -e /etc/update-motd.d/30-zfs ] && \
    ln -s /opt/server/motd/30-zfs /etc/update-motd.d/30-zfs
[ ! -h /etc/update-motd.d/30-zfs ] && \
    rm -r /etc/update-motd.d/30-zfs && \
    ln -s /opt/server/motd /etc/update-motd.d/30-zfs

#systemd
[ ! -e /etc/systemd/system/media-services.service ] && \
    ln -s /opt/server/systemd/docker/media-services.service /etc/systemd/system/media-services.service
[ ! -h /etc/systemd/system/media-services.service ] && \
    rm -r /etc/systemd/system/media-services.service && \
    ln -s /opt/server/systemd/docker/media-services.service /etc/systemd/system/media-services.service

[ ! -e /etc/systemd/system/docker-cleanup.service ] && \
    ln -s /opt/server/systemd/docker/docker-cleanup.service /etc/systemd/system/docker-cleanup.service
[ ! -h /etc/systemd/system/docker-cleanup.service ] && \
    rm -r /etc/systemd/system/docker-cleanup.service && \
    ln -s /opt/server/systemd/docker/docker-cleanup.service /etc/systemd/system/docker-cleanup.service

[ ! -e /etc/systemd/system/docker-cleanup.timer ] && \
    ln -s /opt/server/systemd/docker/docker-cleanup.timer /etc/systemd/system/docker-cleanup.timer
[ ! -h /etc/systemd/system/docker-cleanup.timer ] && \
    rm -r /etc/systemd/system/docker-cleanup.timer && \
    ln -s /opt/server/systemd/docker/docker-cleanup.timer /etc/systemd/system/docker-cleanup.timer

[ ! -e /etc/systemd/system/server-update.service ] && \
    ln -s /opt/server/systemd/system/server-update.service /etc/systemd/system/server-update.service
[ ! -h /etc/systemd/system/server-update.service ] && \
    rm -r /etc/systemd/system/server-update.service && \
    ln -s /opt/server/systemd/system/server-update.service /etc/systemd/system/server-update.service

[ ! -e /etc/systemd/system/server-update.timer ] && \
    ln -s /opt/server/systemd/system/server-update.timer /etc/systemd/system/server-update.timer
[ ! -h /etc/systemd/system/server-update.timer ] && \
    rm -r /etc/systemd/system/server-update.timer && \
    ln -s /opt/server/systemd/system/server-update.timer /etc/systemd/system/server-update.timer

exit 0